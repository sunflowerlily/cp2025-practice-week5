# 最小二乘拟合和光电效应

## 背景介绍

物理实验中产生的数据常常展现出接近线性关系，如下图所示：

![线性关系示意图](https://github.com/user-attachments/assets/f050995e-3bd9-43db-9720-445f381806ee)

这里的实线代表潜在的线性关系，点代表测量的数据。

直线可以用 $y=mx+c$ 描述，可以用最小二乘法来确定合适的斜率 $m$ 和截距 $c$。

假设我们猜测一条直线的 $m$ 和 $c$ 的值，然后计算数据点到这条直线的竖直距离，如图中的竖直线段所示，之后我们计算这些距离的平方和，用 $\chi^2$ 表示，如果共有 $N$ 个数据点，坐标分别为 $(x_i,y_i)$，则有

$$
\chi^2 = \sum_{i=1}^N (mx_i+c-y_i)^2.
$$

对直线的最小二乘拟合就是找到令 $\chi^2$ 取得最小值的直线。可以通过对 $m$ 和 $c$ 分别求导数并让导数为零来确定最小值的点：

$$\begin{align*}
m \sum_{i=1}^N x_i^2 + c \sum_{i=1}^N x_i - \sum_{i=1}^N x_iy_i &= 0, \\
m \sum_{i=1}^N x_i + cN - \sum_{i=1}^N y_i &= 0.
\end{align*}
$$

为方便起见，定义下列变量:

$$
E_x = {1\over N} \sum_{i=1}^N x_i,\qquad
E_y = {1\over N} \sum_{i=1}^N y_i,\qquad
E_{xx} = {1\over N} \sum_{i=1}^N x_i^2,\qquad
E_{xy} = {1\over N} \sum_{i=1}^N x_iy_i,
$$

所以方程可以简化为

$$\begin{align*}
mE_{xx} + cE_x &= E_{xy}\,, \\
mE_x + c &= E_y\,.
\end{align*}$$

解这个方程组可以得到 $m$ 和 $c$

$$
m = {E_{xy}-E_x E_y\over E_{xx} - E_x^2},  
c = {E_{xx}E_y-E_x E_{xy}\over E_{xx} - E_x^2}.
$$

## 光电效应背景

本次作业中的数据文件 `millikan.txt` 来源于 Robert Millikan 所做的著名的光电效应实验。当合适波长的光子打在金属表面时，金属表面的电子可能会因吸收能量而释放到自由空间中。被释放的电子能量等于打在上面的光子能量减去一个小量 $\phi$，代表电子从表面逃逸所需要的能量。光子能量为 $h\nu$, $h$ 代表普朗克常量, $\nu$ 代表光的频率。逃逸电子的能量可以通过使电子停止的电压 $V$ 来测量，有如下关系:

$$
V = {h\over e}\nu - \phi,
$$

这里 $e$ 是电子电荷。这个方程是1905年由爱因斯坦首先给出的。

`millikan.txt` 中的数据第一列代表 $\nu$，单位是赫兹，第二列代表电压 $V$，单位是V。

这个计算基本上与Millikan自己做的测量普朗克常量的实验相同，尽管由于缺少计算机，他是用眼睛拟合的直线。这个工作是Millikan获得1923年的诺贝尔物理奖工作的一部分。

## 作业要求

1. 读取 `millikan.txt` 文件中的数据，并用散点图显示这些数据点。

2. 计算 $E_x$, $E_y$, $E_{xx}$, 和 $E_{xy}$，然后计算并打印 $m$ 和 $c$ 的值。

3. 使用计算得到的 $m$ 和 $c$ 值，生成拟合直线，并将这条直线与原始数据点一起绘制在同一张图上。

4. 根据光电效应方程，计算普朗克常量 $h$（电子电荷取 $e = 1.602\times10^{-19}$ C），并与实际值进行比较。

## 提交要求

1. 完成 `src/millikan_fit.py` 文件中的代码。
2. 确保代码能够通过 `tests/test_millikan.py` 中的测试。
3. 提交时包含生成的图像和计算结果。
